<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Insertion d'un M√©moire Acad√©mique</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
      :root {
        --bg: #0b1020;
        --card: #0f1730;
        --accent: #6aa7ff;
        --accent-2: #9dd1ff;
        --text: #e9eefc;
        --muted: #b7c3e2;
        --danger: #ff7a7a;
        --ring: 0 0 0 3px rgba(106, 167, 255, 0.35);
        --radius: 16px;
      }
      
      /* Light theme variables */
      [data-theme="light"] {
        --bg: #f5f7fa;
        --card: #ffffff;
        --accent: #4a8eef;
        --accent-2: #2563eb;
        --text: #1a202c;
        --muted: #4a5568;
        --danger: #e53e3e;
        --ring: 0 0 0 3px rgba(74, 142, 239, 0.35);
      }
      
      /* Theme toggle button */
      .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: var(--text);
        padding: 12px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.3rem;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .theme-toggle:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: scale(1.05);
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial,
          "Segoe UI Emoji", "Apple Color Emoji", "Noto Color Emoji", sans-serif;
        background: radial-gradient(
            1200px 800px at 10% -10%,
            #1a2a55 0%,
            transparent 60%
          ),
          radial-gradient(1000px 800px at 110% 10%, #122148 0%, transparent 60%),
          var(--bg);
        color: var(--text);
        line-height: 1.5;
      }
      .container {
        max-width: 1100px;
        margin: 40px auto;
        padding: 0 16px;
      }
      header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 16px;
        margin-bottom: 24px;
      }
      h1 {
        margin: 0;
        font-size: clamp(1.3rem, 1.2rem + 1.2vw, 2rem);
        letter-spacing: 0.2px;
      }
      .subtitle {
        margin: 6px 0 0 0;
        color: var(--muted);
        font-size: 0.95rem;
      }
      .grid {
        display: grid;
        gap: 18px;
        grid-template-columns: 1fr;
      }
      @media (min-width: 920px) {
        .grid {
          grid-template-columns: 1.5fr 1fr; /* Form card is now wider */
        }
      }
      .card {
        background: linear-gradient(
            180deg,
            rgba(255, 255, 255, 0.03),
            transparent 50%
          ),
          var(--card);
        border: 1px solid rgba(255, 255, 255, 0.07);
        border-radius: var(--radius);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        padding: 22px;
      }
      .card h2 {
        margin: 0 0 12px 0;
        font-size: 1.05rem;
        color: var(--accent-2);
        letter-spacing: 0.3px;
        font-weight: 600;
      }
      form {
        display: grid;
        gap: 20px;
      }
      .row {
        display: grid;
        gap: 16px;
      }
      /* All inputs full width for maximum size */
      .row.two {
        grid-template-columns: 1fr; /* Full width instead of two columns */
      }
      label {
        display: block;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 8px;
        color: var(--muted);
      }
      /* Grand inputs styling */
      input[type="text"],
      input[type="file"],
      select {
        width: 100%;
        min-width: 0; /* Prevent expansion */
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text);
        padding: 18px 20px;
        font-size: 1.1rem;
        border-radius: 12px;
        outline: none;
        transition: border 0.2s, box-shadow 0.2s, background 0.2s;
        /* Make inputs scrollable vertically only */
        overflow-x: hidden; /* No horizontal scroll */
        overflow-y: auto;
        max-height: 150px;
        white-space: normal; /* Allow wrapping */
        word-wrap: break-word;
        overflow-wrap: break-word;
        word-break: break-all; /* Force break long words */
      }
      input[type="file"] {
        padding: 14px;
      }
      input:focus,
      select:focus {
        border-color: var(--accent);
        box-shadow: var(--ring);
        background: rgba(255, 255, 255, 0.07);
      }
      
      /* Quill Editor Customization for Dark Theme */
      .ql-toolbar.ql-snow {
        border-color: rgba(255, 255, 255, 0.12) !important;
        border-radius: 12px 12px 0 0;
        background: rgba(255, 255, 255, 0.05);
      }
      .ql-container.ql-snow {
        border-color: rgba(255, 255, 255, 0.12) !important;
        border-radius: 0 0 12px 12px;
        background: rgba(255, 255, 255, 0.02);
        color: var(--text);
        font-family: Inter, sans-serif;
        font-size: 1rem;
        margin-bottom: 20px; /* Add space between editors */
      }
      .ql-editor {
        min-height: 200px;
        max-height: 500px;
        overflow-y: auto;
        overflow-x: hidden; /* No horizontal scroll */
        word-wrap: break-word;
        overflow-wrap: break-word;
        word-break: break-all; /* Force break long words */
      }
      /* Quill toolbar icons color override */
      .ql-snow .ql-stroke {
        stroke: var(--muted) !important;
      }
      .ql-snow .ql-fill {
        fill: var(--muted) !important;
      }
      .ql-snow .ql-picker {
        color: var(--muted) !important;
      }

      .hint {
        margin-top: 6px;
        font-size: 0.82rem;
        color: var(--muted);
      }
      .actions {
        display: flex;
        gap: 12px;
        align-items: center;
        justify-content: flex-end;
        margin-top: 10px;
      }
      .btn {
        appearance: none;
        border: 0;
        padding: 16px 28px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1.05rem;
        cursor: pointer;
        transition: transform 0.03s ease, box-shadow 0.2s ease;
      }
      .btn:active {
        transform: translateY(1px);
      }
      .btn-primary {
        background: linear-gradient(180deg, var(--accent), #4a8eef);
        color: #06122a;
        box-shadow: 0 10px 20px rgba(74, 142, 239, 0.25);
      }
      .btn-secondary {
        background: transparent;
        color: var(--accent-2);
        border: 1px solid rgba(255, 255, 255, 0.14);
      }
      hr {
        border: 0;
        height: 1px;
        background: linear-gradient(
          to right,
          transparent,
          rgba(255, 255, 255, 0.12),
          transparent
        );
        margin: 28px 0;
      }
      .badge {
        display: inline-flex;
        gap: 8px;
        align-items: center;
        font-size: 0.78rem;
        color: var(--muted);
        padding: 6px 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.03);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div>
          <div class="badge">ThesisPlag ‚Ä¢ Saisie & Recherche</div>
          <h1>Insertion d'un M√©moire Acad√©mique</h1>
          <p class="subtitle">
            Renseignez les m√©tadonn√©es et t√©l√©versez le PDF. Le syst√®me extraira
            le texte et les √©l√©ments visuels pour l'analyse s√©mantique.
          </p>
        </div>
        <nav style="display: flex; gap: 20px; align-items: center;">
            <a href="{{ url_for('index') }}" class="btn btn-secondary" style="text-decoration: none; font-size: 0.9rem;">Accueil</a>
            <a href="{{ url_for('theses') }}" class="btn btn-secondary" style="text-decoration: none; font-size: 0.9rem;">Tous les m√©moires</a>
        </nav>
      </header>

      <!-- Theme toggle button (fixed position) -->
      <button class="theme-toggle" onclick="toggleTheme()" title="Changer de th√®me">
        <span id="theme-icon">üåô</span>
      </button>

      <div class="grid">
        <!-- Carte : Formulaire d'upload -->
        <section class="card">
          <h2>Formulaire de fiche Technique</h2>
          <form id="uploadForm" action="/upload" method="POST" enctype="multipart/form-data">
            <div class="row two">
              <div>
                <label for="title">Titre du th√®me</label>
                <input type="text" id="title" name="title" required />
              </div>
              <div>
                <label for="theme">Th√®me / Sujet</label>
                <input type="text" id="theme" name="theme" required />
              </div>
            </div>

            <div class="row two">
              <div>
                <label for="author">Nom et Pr√©nom</label>
                <input type="text" id="author" name="author" required />
              </div>
              <div>
                <label for="university">Universit√© d'accueil</label>
                <input type="text" id="university" name="university" required />
              </div>
            </div>

            <div class="row two">
              <div>
                <label for="thesis_type">Type de m√©moire</label>
                <select id="thesis_type" name="thesis_type">
                  <option value="research">Recherche</option>
                  <option value="professional">Professionnel / Stage</option>
                </select>
              </div>
              <div>
                <label for="stage_location">Lieu de stage / d'√©tude</label>
                <input type="text" id="stage_location" name="stage_location" required />
              </div>
            </div>

            <div>
              <label for="methodology">M√©thodologie et objectifs</label>
              <div id="editor-methodology"></div>
              <input type="hidden" name="methodology" id="methodology">
            </div>

            <div style="margin-top: 80px;">
              <label for="results">R√©sultats (technologies, outils, etc.)</label>
              <div id="editor-results"></div>
              <input type="hidden" name="results" id="results">
            </div>

            <div>
              <label for="pdf_file">Fichier PDF</label>
              <input type="file" id="pdf_file" name="pdf_file" accept="application/pdf" required />
              <div class="hint">Formats accept√©s : PDF</div>
            </div>

            <div class="actions">
              <button class="btn btn-secondary" type="reset">R√©initialiser</button>
              <button class="btn btn-primary" type="submit">Envoyer</button>
            </div>
          </form>
        </section>

        <!-- Carte : Recherche -->
        <section class="card">
          <h2>Recherche de m√©moires similaires</h2>
          <form action="/search" method="GET">
            <div>
              <label for="query">Recherche par contenu / th√®me</label>
              <input type="text" id="query" name="query" required placeholder="Ex. D√©tection de plagiat, IA, m√©thodologie, etc." />
            </div>
            <div class="actions" style="justify-content: flex-start; margin-top: 6px">
              <button class="btn btn-primary" type="submit">Rechercher</button>
            </div>
            <p class="hint">
              Astuce : utilisez des mots-cl√©s pr√©cis (ex. ¬´ paraphrase
              s√©mantique ¬ª, ¬´ deep learning ¬ª, ¬´ figures similaires ¬ª).
            </p>
          </form>
          <hr />
        </section>
      </div>
    </div>

    <!-- Quill JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
      // Initialize Quill editors
      var quillMethodology = new Quill('#editor-methodology', {
        theme: 'snow',
        placeholder: 'D√©crivez bri√®vement les approches, protocoles, jeux de donn√©es, objectifs et indicateurs...'
      });

      var quillResults = new Quill('#editor-results', {
        theme: 'snow',
        placeholder: 'Synth√®se des principaux r√©sultats, contributions, outils et limites...'
      });

      // Form submission handler
      var form = document.querySelector('#uploadForm');
      form.onsubmit = function() {
        var methodologyContent = document.querySelector('#methodology');
        var resultsContent = document.querySelector('#results');
        
        // Saving text content
        methodologyContent.value = quillMethodology.getText();
        resultsContent.value = quillResults.getText();
      };

      // Theme toggle functionality
      function toggleTheme() {
        const html = document.documentElement;
        const currentTheme = html.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        const themeIcon = document.getElementById('theme-icon');
        
        html.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        // Update icon
        themeIcon.textContent = newTheme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      }

      // Load saved theme on page load
      (function() {
        const savedTheme = localStorage.getItem('theme') || 'dark';
        const themeIcon = document.getElementById('theme-icon');
        
        document.documentElement.setAttribute('data-theme', savedTheme);
        themeIcon.textContent = savedTheme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      })();
    </script>
  </body>
</html>
